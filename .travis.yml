language: node_js

node_js:
  - "node"
  - "lts/*"

before_script:
  - npm run lint

before_deploy:
  - REPO_VERSION="$(npx -c 'echo "$npm_package_version"')"
  - echo "REPO_VERSION=$REPO_VERSION"
  - |
    if [ "$TRAVIS_BRANCH" == "master" ]; then
      git tag -a -f "$REPO_VERSION"
      echo "New Tag $(git describe --tags)";
    fi

deploy:
  - provider: releases
    api_key: $GITHUB_TOKEN
    on:
      branch: master
  - provider: npm
    email: "brian.folts@gmail.com"
    api_key: $NPM_API_KEY
    on:
      tags: true
